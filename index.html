<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>科学发展小镇</title>
  <!-- 国内CDN资源 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#1E40AF',
            secondary: '#16A34A',
            accent: '#F59E0B',
          },
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto { content-visibility: auto; }
      .decision-card { 
        @apply bg-white rounded-xl shadow-md p-5 mb-4 transition-all duration-300 hover:shadow-lg hover:-translate-y-1 cursor-pointer border-2 border-transparent hover:border-primary/30;
      }
      .stat-bar { @apply h-3 rounded-full overflow-hidden; }
      .stat-fill { @apply h-full transition-all duration-1500 ease-out; }
      .score-change { @apply absolute -top-6 left-1/2 -translate-x-1/2 px-2 py-1 rounded text-xs font-bold animate-fade-in-up; }
      .fade-in { animation: fadeIn 0.5s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    }
  </style>
</head>

<body class="bg-gray-50 min-h-screen">
  <!-- 顶部导航 -->
  <header class="bg-primary text-white p-4 shadow-md">
    <div class="container mx-auto flex justify-between items-center">
      <h1 class="text-xl font-bold"><i class="fa fa-leaf mr-2"></i>科学发展小镇</h1>
      <div id="stage-indicator" class="text-sm">阶段：1/8</div>
    </div>
  </header>

  <!-- 主内容区 -->
  <main class="container mx-auto p-4 max-w-2xl">
    <!-- 状态面板 -->
    <div class="bg-white rounded-xl shadow p-4 mb-6">
      <h2 class="text-lg font-semibold mb-3">小镇发展状态</h2>
      <div class="grid grid-cols-3 gap-4">
        <!-- 经济指数 -->
        <div class="relative">
          <div class="flex justify-between items-center mb-1">
            <span class="text-accent text-sm"><i class="fa fa-line-chart mr-1"></i>经济指数</span>
            <span id="economy-value" class="text-sm font-medium">30</span>
          </div>
          <div class="stat-bar bg-gray-200">
            <div id="economy-bar" class="stat-fill bg-accent" style="width: 30%"></div>
          </div>
          <div id="economy-change" class="score-change hidden"></div>
        </div>
        <!-- 生态指数 -->
        <div class="relative">
          <div class="flex justify-between items-center mb-1">
            <span class="text-secondary text-sm"><i class="fa fa-tree mr-1"></i>生态指数</span>
            <span id="ecology-value" class="text-sm font-medium">40</span>
          </div>
          <div class="stat-bar bg-gray-200">
            <div id="ecology-bar" class="stat-fill bg-secondary" style="width: 40%"></div>
          </div>
          <div id="ecology-change" class="score-change hidden"></div>
        </div>
        <!-- 民生指数 -->
        <div class="relative">
          <div class="flex justify-between items-center mb-1">
            <span class="text-primary text-sm"><i class="fa fa-users mr-1"></i>民生指数</span>
            <span id="people-value" class="text-sm font-medium">35</span>
          </div>
          <div class="stat-bar bg-gray-200">
            <div id="people-bar" class="stat-fill bg-primary" style="width: 35%"></div>
          </div>
          <div id="people-change" class="score-change hidden"></div>
        </div>
      </div>
    </div>

    <!-- 剧情/决策区域 -->
    <div id="game-container">
      <!-- 初始剧情 -->
      <div id="story-section" class="bg-white rounded-xl shadow p-5 mb-6">
        <h2 class="text-xl font-bold mb-3 text-primary">小镇的起点</h2>
        <p class="text-gray-700 mb-4">
          2003年，你走马上任成为"科学发展小镇"的镇长。这是一个资源丰富但发展滞后的小镇，全镇3万居民既期待经济发展带来的生活改善，又担心环境被破坏。
          你的第一个任务是制定未来五年的发展规划，这将奠定小镇发展的基调...
        </p>
        <button id="start-btn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors">
          开始规划
        </button>
      </div>

      <!-- 决策区域（默认隐藏） -->
      <div id="decision-section" class="hidden">
        <h2 id="decision-title" class="text-xl font-bold mb-4 text-primary"></h2>
        <p id="decision-description" class="text-gray-700 mb-5"></p>
        <div id="decision-cards" class="space-y-3"></div>
      </div>

      <!-- 结果解读区域（默认隐藏） -->
      <div id="result-section" class="hidden bg-white rounded-xl shadow p-5 mb-6">
        <h2 class="text-xl font-bold mb-3 text-primary">决策影响</h2>
        <div id="result-description" class="text-gray-700 mb-4"></div>
        
        <div id="theory-explanation" class="bg-blue-50 p-4 rounded-lg border-l-4 border-primary mb-5">
          <h3 class="font-semibold text-primary mb-2">科学发展观解读</h3>
          <p id="theory-text" class="text-gray-700 mb-3"></p>
          <div class="text-sm text-primary italic">
            科学发展观核心内涵：第一要义是发展，核心是以人为本，基本要求是全面协调可持续，根本方法是统筹兼顾。
          </div>
        </div>

        <button id="next-btn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors">
          进入下一阶段
        </button>
      </div>

      <!-- 阶段过渡剧情（默认隐藏） -->
      <div id="transition-section" class="hidden bg-white rounded-xl shadow p-5 mb-6">
        <h2 class="text-xl font-bold mb-3 text-primary" id="transition-title"></h2>
        <p class="text-gray-700 mb-4" id="transition-text"></p>
        <button id="continue-btn" class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors">
          继续决策
        </button>
      </div>

      <!-- 最终结果（默认隐藏） -->
      <div id="final-result" class="hidden bg-white rounded-xl shadow p-5 mb-6">
        <h2 class="text-2xl font-bold mb-4 text-primary text-center">十年发展总结</h2>
        <div class="text-center mb-6">
          <div class="inline-block p-4 rounded-full bg-primary/10 mb-2">
            <i class="fa fa-trophy text-4xl text-accent"></i>
          </div>
          <h3 id="final-score" class="text-xl font-bold"></h3>
        </div>
        <div id="final-evaluation" class="text-gray-700 mb-6 leading-relaxed"></div>
        
        <div class="bg-blue-50 p-4 rounded-lg border-l-4 border-primary mb-6">
          <h3 class="font-semibold text-primary mb-2">科学发展观实践启示</h3>
          <p class="text-gray-700 text-sm">
            1. 发展必须是全面的：经济、政治、文化、社会、生态建设五位一体<br>
            2. 协调是关键：解决发展不平衡问题，实现各领域相互促进<br>
            3. 可持续是基础：既要满足当代人需求，又不损害后代人发展能力<br>
            4. 以人为本是核心：发展的最终目的是实现人的全面发展
          </p>
        </div>
        
        <button id="restart-btn" class="w-full bg-primary text-white px-6 py-3 rounded-lg hover:bg-primary/90 transition-colors">
          重新体验
        </button>
      </div>
    </div>
  </main>

  <footer class="bg-gray-800 text-white p-4 mt-8">
    <div class="container mx-auto text-center text-sm">
      <p>毛概第八章-科学发展观 小组作业 | 模拟小镇发展决策</p>
    </div>
  </footer>

  <script>
    // 游戏数据
    const gameData = {
      stage: 1,
      maxStages: 8,
      stats: {
        economy: 30,
        ecology: 40,
        people: 35
      },
      // 扩充为8个阶段，每个阶段包含决策和过渡剧情
      scenarios: [
        {
          title: "初期产业选择",
          description: "小镇财政紧张，需要快速积累资金。现有三个产业方向可供选择，你倾向于：",
          decisions: [
            {
              text: "引进大型化工企业（承诺每年纳税5000万，但有一定污染）",
              effects: { economy: +40, ecology: -50, people: +10 },
              result: "化工企业带来了显著的财政收入，镇政府有了资金改善基础设施，但周边村庄出现了水源污染问题，村民开始上访。",
              theory: "这种选择只注重经济发展（第一要义），却忽视了生态保护和民生福祉，违背了'全面协调可持续'的基本要求。科学发展观强调，发展不能以牺牲环境为代价，否则会引发新的社会矛盾。"
            },
            {
              text: "发展特色种植产业（与农业科研所合作，收益稳定但见效慢）",
              effects: { economy: +15, ecology: +20, people: +20 },
              result: "特色种植基地建成后，不仅带动了农民增收，还吸引了周边游客体验农耕文化，形成了'农业+旅游'的良性循环，环境也得到了保护。",
              theory: "这体现了'统筹兼顾'的根本方法，既发展了经济（第一要义），又保护了生态，还提高了农民收入（以人为本），实现了三个维度的协调发展，符合科学发展观的核心要求。"
            },
            {
              text: "举债建设工业园区（先筑巢后引凤，未来收益可期）",
              effects: { economy: +5, ecology: -10, people: -5 },
              result: "工业园区建成后，由于区位优势不足，招商困难，镇政府背上了沉重的债务，不得不削减教育和医疗开支，引起居民不满。",
              theory: "发展需要遵循客观规律，盲目举债发展违背了科学发展的原则。科学发展观要求实事求是，既要积极作为，又不能脱离实际，否则会损害群众利益（违背以人为本）。"
            },
            {
              text: "优先发展劳务输出（组织村民外出务工，短期内增加收入）",
              effects: { economy: +10, ecology: +5, people: +5 },
              result: "大量青壮年外出务工，短期内村民收入有所增加，但导致农村空心化，留守儿童和老人问题突出，小镇发展缺乏后劲。",
              theory: "这种选择忽视了发展的'可持续性'。科学发展观强调，发展应该立足本地实际，培育内生动力，而不是依赖外部资源，否则会导致发展不可持续。"
            }
          ],
          transition: {
            title: "五年后的转折",
            text: "经过五年发展，小镇面貌有了初步变化，但新的问题开始显现。随着周边地区快速发展，人才和资源竞争加剧，你的下一个挑战是如何提升小镇的核心竞争力..."
          }
        },
        {
          title: "资源开发争议",
          description: "小镇发现一处优质煤矿，多家企业提出开发申请，同时环保组织呼吁保护当地森林生态系统，你会：",
          decisions: [
            {
              text: "批准外资企业的露天采矿方案（投资大、见效快，但森林破坏严重）",
              effects: { economy: +50, ecology: -60, people: +5 },
              result: "煤矿开采带来了巨额税收，但大片森林被砍伐，水土流失严重，下游村庄出现洪涝灾害，虽然居民得到了一定补偿，但环境破坏难以逆转。",
              theory: "这种选择只追求经济增长，忽视了生态承载能力，违背了'可持续'的基本要求。科学发展观认为，自然资源是发展的基础，必须合理开发、永续利用，不能吃祖宗饭、断子孙路。"
            },
            {
              text: "采用生态开采模式（井下开采，配套污水处理和植被恢复）",
              effects: { economy: +25, ecology: -10, people: +15 },
              result: "煤矿有序开采，同时投入资金进行生态修复，实现了经济效益和生态保护的平衡，本地村民也通过参与工程建设获得了收入。",
              theory: "这体现了'全面协调可持续'的要求，在发展经济的同时兼顾生态保护，通过技术创新实现了资源开发与环境保护的协调，符合科学发展观的内涵。"
            },
            {
              text: "拒绝采矿，申请建立自然保护区（争取国家生态补偿）",
              effects: { economy: -5, ecology: +40, people: +10 },
              result: "自然保护区获批后，小镇生态环境得到严格保护，吸引了科研机构入驻，但由于缺乏产业支撑，年轻人口持续外流，经济发展缓慢。",
              theory: "这种选择忽视了'发展是第一要义'。科学发展观强调，保护生态环境需要以一定的经济发展为基础，没有发展，生态保护和民生改善都会缺乏支撑，难以持续。"
            }
          ],
          transition: {
            title: "发展中的阵痛",
            text: "资源开发的决策引发了广泛讨论，部分村民支持发展经济，部分则担忧环境恶化。随着城镇化推进，小镇面临新的规划难题..."
          }
        },
        {
          title: "城镇规划难题",
          description: "小镇人口从3万增长到5万，需要扩大城镇规模，现有两块土地可供开发，你会选择：",
          decisions: [
            {
              text: "占用城郊湿地建设新城区（地势平坦，开发成本低）",
              effects: { economy: +30, ecology: -40, people: +20 },
              result: "新城区快速建成，缓解了住房紧张，但湿地消失导致本地气候变得干燥，夏季暴雨时内涝严重，居民生活受到影响。",
              theory: "这种选择违背了'人与自然和谐发展'的要求。科学发展观强调，发展必须尊重自然规律，湿地作为重要的生态系统，具有调节气候、蓄洪防旱的功能，牺牲生态空间换取城镇发展，最终会受到自然的惩罚。"
            },
            {
              text: "改造旧城区+建设卫星村（保护湿地，分散式发展）",
              effects: { economy: +15, ecology: +10, people: +25 },
              result: "通过旧城区改造和卫星村建设，既保护了生态环境，又改善了居民居住条件，还保留了小镇原有的历史风貌，获得了上级部门的肯定。",
              theory: "这体现了'统筹兼顾'的方法，在城镇发展中协调了经济、社会和生态的关系，既满足了居民的住房需求（以人为本），又保护了生态环境，实现了可持续发展。"
            },
            {
              text: "严格限制人口流入（维持现状，避免环境压力）",
              effects: { economy: -15, ecology: +15, people: -20 },
              result: "人口限制政策导致劳动力短缺，企业难以扩大生产，商业也逐渐萧条，本地年轻人因发展机会少而外出，小镇逐渐失去活力。",
              theory: "这种选择违背了'发展是第一要义'。科学发展观认为，人口聚集是城镇化的必然趋势，也是发展的动力，应该通过科学规划提升承载能力，而不是通过限制发展来逃避问题。"
            }
          ],
          transition: {
            title: "产业升级压力",
            text: "随着周边地区产业升级，小镇的传统产业竞争力下降，出现了企业效益下滑、就业岗位减少的问题，产业转型迫在眉睫..."
          }
        },
        {
          title: "产业升级路径",
          description: "为应对传统产业衰退，需要培育新的经济增长点，你认为应该重点发展：",
          decisions: [
            {
              text: "承接东部地区劳动密集型产业转移（技术门槛低，能快速增加就业）",
              effects: { economy: +20, ecology: -25, people: +15 },
              result: "多家加工厂入驻，解决了就业问题，但这些企业技术含量低、污染较大，随着环保标准提高，未来面临整改或搬迁的风险。",
              theory: "这种选择虽然暂时解决了就业问题，但忽视了发展的'质量和效益'。科学发展观要求转变经济发展方式，推动产业升级，而不是简单承接落后产能，否则会陷入'低端锁定'的困境。"
            },
            {
              text: "发展绿色农产品加工和乡村旅游（结合本地资源，生态友好）",
              effects: { economy: +25, ecology: +30, people: +30 },
              result: "依托良好的生态环境，小镇开发了有机农产品和乡村旅游项目，吸引了大量城市游客，形成了特色产业链，村民收入大幅提高。",
              theory: "这体现了'因地制宜'的科学发展思路，立足本地资源优势，发展生态友好型产业，实现了经济发展、生态保护和民生改善的统一，符合'全面协调可持续'的要求。"
            },
            {
              text: "举债建设高新技术园区（瞄准未来，力求跨越式发展）",
              effects: { economy: +5, ecology: +10, people: -5 },
              result: "高新技术园区建成后，由于缺乏人才和配套产业，难以吸引企业入驻，巨额债务导致镇政府不得不压缩公共服务支出，居民怨声载道。",
              theory: "这种选择脱离了小镇的实际发展阶段，违背了科学发展观的'实事求是'原则。发展需要循序渐进，盲目追求跨越式发展，反而会损害群众利益，影响发展的可持续性。"
            }
          ],
          transition: {
            title: "社会矛盾显现",
            text: "产业转型过程中，不同群体的利益诉求出现分歧：部分企业主希望政府提供更多优惠政策，普通居民则更关注教育、医疗等公共服务..."
          }
        },
        {
          title: "公共服务分配",
          description: "当年财政收入有1000万元结余，如何分配这笔资金成为焦点，你的方案是：",
          decisions: [
            {
              text: "主要用于企业扶持（减税降费+产业补贴，希望带动就业）",
              effects: { economy: +30, ecology: 0, people: -10 },
              result: "企业负担减轻，部分企业扩大了生产，但教育和医疗投入不足，学校师资流失，医院设备老化，居民对公共服务满意度下降。",
              theory: "这种选择忽视了'以人为本'的核心。科学发展观认为，发展的最终目的是为了人民，财政支出应该优先保障民生需求，否则即使经济增长了，群众也感受不到发展的成果。"
            },
            {
              text: "重点改善民生（新建学校和卫生院，提高社保标准）",
              effects: { economy: -5, ecology: +5, people: +40 },
              result: "教育和医疗条件得到显著改善，居民幸福感提升，但由于缺乏对企业的支持，部分中小企业经营困难，就业岗位增长缓慢。",
              theory: "这种选择体现了'以人为本'的核心，但忽视了'发展是第一要义'。科学发展观要求统筹经济发展与社会建设，只有经济持续发展，才能为民生改善提供坚实基础，否则民生投入也难以持续。"
            },
            {
              text: "均衡分配（40%用于企业扶持，40%用于民生改善，20%用于生态治理）",
              effects: { economy: +15, ecology: +15, people: +25 },
              result: "企业获得了必要的支持，民生条件也得到改善，同时对污染企业进行了治理，经济、社会、生态呈现协调发展的良好态势。",
              theory: "这是'统筹兼顾'根本方法的典型体现，既重视发展经济（第一要义），又注重改善民生（以人为本），还兼顾生态保护，实现了三个维度的协调平衡，符合科学发展观的全面要求。"
            }
          ],
          transition: {
            title: "生态补偿争议",
            text: "小镇上游的村庄为保护水源地牺牲了发展机会，要求小镇给予生态补偿，而小镇企业则认为这会增加负担，双方矛盾激化..."
          }
        },
        {
          title: "生态补偿机制",
          description: "关于上游水源地保护的生态补偿问题，需要制定合理方案，你倾向于：",
          decisions: [
            {
              text: "由企业承担全部补偿费用（按排污量收费，专款专用）",
              effects: { economy: -20, ecology: +30, people: +10 },
              result: "企业负担加重，部分高污染企业搬迁，水源地得到保护，但小镇经济增长放缓，就业受到一定影响。",
              theory: "这种选择虽然有利于生态保护，但将成本全部转嫁给企业，影响了经济发展活力。科学发展观要求'统筹兼顾'各方利益，生态保护是全社会的责任，需要多方共同参与，而不是由单一群体承担。"
            },
            {
              text: "政府、企业、居民共同承担（财政补贴+企业付费+用水户加价）",
              effects: { economy: -5, ecology: +40, people: +15 },
              result: "建立了多元化的生态补偿机制，上游村庄获得了合理补偿，水源地得到有效保护，同时通过技术改造，企业污染排放大幅减少。",
              theory: "这体现了'全面协调可持续'的要求，通过建立合理的利益协调机制，平衡了经济发展与生态保护的关系，让保护者受益、使用者付费、破坏者赔偿，符合科学发展观的内涵。"
            },
            {
              text: "暂缓补偿，优先保障经济发展（待财政宽裕后再解决）",
              effects: { economy: +10, ecology: -30, people: -5 },
              result: "企业负担减轻，经济保持增长，但上游村庄因缺乏保护资金，开始无序开发，导致水源污染，小镇不得不投入更多资金治理。",
              theory: "这种选择忽视了生态保护的重要性，违背了'可持续发展'的要求。科学发展观强调，生态环境保护是发展的基础，牺牲生态环境换取短期经济增长，最终会付出更大的代价，影响长远发展。"
            }
          ],
          transition: {
            title: "城乡差距问题",
            text: "随着城镇发展加快，乡村与城镇的差距逐渐拉大，农村基础设施落后、公共服务不足的问题日益突出，需要制定城乡统筹发展规划..."
          }
        },
        {
          title: "城乡统筹发展",
          description: "为缩小城乡差距，需要制定具体措施，你认为重点应该是：",
          decisions: [
            {
              text: "推动农村人口向城镇转移（加快城镇化，减少农村人口）",
              effects: { economy: +20, ecology: -10, people: +10 },
              result: "城镇化率提高，城镇规模扩大，但农村空心化加剧，耕地撂荒，传统文化流失，部分农民进城后难以适应，生活困难。",
              theory: "这种选择简单地将城镇化理解为人口转移，忽视了乡村的自身发展。科学发展观要求'统筹城乡发展'，不是让乡村消失，而是实现城乡互补、协调发展，让农村居民也能共享发展成果。"
            },
            {
              text: "推进城乡基础设施一体化（修路、通水、通电，资源共享）",
              effects: { economy: +15, ecology: +10, people: +30 },
              result: "城乡道路、供水、教育、医疗等设施逐步统一规划建设，农村居民生活条件大幅改善，同时通过发展乡村特色产业，吸引了部分人才返乡创业。",
              theory: "这体现了'统筹兼顾'的根本方法，通过推动城乡基础设施一体化，缩小了发展差距，让农村居民也能享受与城镇同等的公共服务（以人为本），实现了城乡协调发展，符合科学发展观的要求。"
            },
            {
              text: "重点发展城镇，辐射带动农村（先富带后富，逐步缩小差距）",
              effects: { economy: +25, ecology: -5, people: +5 },
              result: "城镇经济快速发展，但由于缺乏对农村的直接投入，城乡差距进一步扩大，农村优质资源持续向城镇集中，形成恶性循环。",
              theory: "这种选择忽视了发展的'协调性'。科学发展观强调，城乡发展是相互依存的，没有农村的发展，城镇发展也会失去支撑，必须同步推进、协调发展，而不是等待'自然辐射'。"
            }
          ],
          transition: {
            title: "发展成果检验",
            text: "十年任期即将结束，你的一系列决策已经产生了深远影响。小镇的发展成果如何？居民的生活发生了哪些变化？是时候总结了..."
          }
        },
        {
          title: "长远发展战略",
          description: "作为离任前的最后决策，你需要为小镇制定未来十年的发展战略，核心方向是：",
          decisions: [
            {
              text: "建设生态宜居小镇（限制工业发展，重点保护生态环境）",
              effects: { economy: +5, ecology: +40, people: +20 },
              result: "小镇生态环境优美，成为远近闻名的宜居之地，但由于工业基础薄弱，财政收入有限，难以持续改善公共服务，年轻人就业选择有限。",
              theory: "这种选择虽然重视生态保护，但忽视了'发展是第一要义'。科学发展观要求的可持续发展，是经济、社会、生态的协调发展，而不是为了保护生态而放弃发展，否则难以实现人的全面发展。"
            },
            {
              text: "打造区域经济强镇（吸引投资，大力发展产业园区）",
              effects: { economy: +40, ecology: -10, people: +15 },
              result: "产业园区规模不断扩大，经济总量大幅提升，成为区域经济中心，但人口过度集中导致交通拥堵、环境压力增大，居民生活质量受到影响。",
              theory: "这种选择过度强调经济增长，忽视了发展的'全面性'。科学发展观认为，发展不仅是经济增长，还包括社会进步和生态良好，单纯追求经济规模，会导致发展失衡，最终影响发展的可持续性。"
            },
            {
              text: "构建全面协调发展格局（经济、社会、生态协同推进）",
              effects: { economy: +30, ecology: +25, people: +35 },
              result: "小镇形成了特色产业体系，生态环境优美，公共服务完善，居民幸福感强，被评为'科学发展示范镇'，实现了经济发展、社会进步和生态保护的有机统一。",
              theory: "这完全符合科学发展观的要求：以发展为第一要义，以以人为本为核心，以全面协调可持续为基本要求，以统筹兼顾为根本方法，实现了经济、社会、生态的协调发展，是科学发展的典范。"
            }
          ]
        }
      ]
    };

    // DOM元素
    const elements = {
      stageIndicator: document.getElementById('stage-indicator'),
      // 指数显示
      economyValue: document.getElementById('economy-value'),
      economyBar: document.getElementById('economy-bar'),
      economyChange: document.getElementById('economy-change'),
      ecologyValue: document.getElementById('ecology-value'),
      ecologyBar: document.getElementById('ecology-bar'),
      ecologyChange: document.getElementById('ecology-change'),
      peopleValue: document.getElementById('people-value'),
      peopleBar: document.getElementById('people-bar'),
      peopleChange: document.getElementById('people-change'),
      // 场景区域
      storySection: document.getElementById('story-section'),
      startBtn: document.getElementById('start-btn'),
      decisionSection: document.getElementById('decision-section'),
      decisionTitle: document.getElementById('decision-title'),
      decisionDescription: document.getElementById('decision-description'),
      decisionCards: document.getElementById('decision-cards'),
      resultSection: document.getElementById('result-section'),
      resultDescription: document.getElementById('result-description'),
      theoryText: document.getElementById('theory-text'),
      nextBtn: document.getElementById('next-btn'),
      transitionSection: document.getElementById('transition-section'),
      transitionTitle: document.getElementById('transition-title'),
      transitionText: document.getElementById('transition-text'),
      continueBtn: document.getElementById('continue-btn'),
      finalResult: document.getElementById('final-result'),
      finalScore: document.getElementById('final-score'),
      finalEvaluation: document.getElementById('final-evaluation'),
      restartBtn: document.getElementById('restart-btn')
    };

    // 更新状态显示
    function updateStats(showChanges = false, changes = {}) {
      // 更新数值和进度条
      elements.economyValue.textContent = gameData.stats.economy;
      elements.economyBar.style.width = `${gameData.stats.economy}%`;
      elements.ecologyValue.textContent = gameData.stats.ecology;
      elements.ecologyBar.style.width = `${gameData.stats.ecology}%`;
      elements.peopleValue.textContent = gameData.stats.people;
      elements.peopleBar.style.width = `${gameData.stats.people}%`;

      // 显示分数变化动画
      if (showChanges) {
        // 经济变化
        if (changes.economy) {
          elements.economyChange.textContent = `${changes.economy >= 0 ? '+' : ''}${changes.economy}`;
          elements.economyChange.className = `score-change ${changes.economy >= 0 ? 'text-green-500 bg-green-100' : 'text-red-500 bg-red-100'}`;
          setTimeout(() => elements.economyChange.classList.add('hidden'), 2000);
        }
        // 生态变化
        if (changes.ecology) {
          elements.ecologyChange.textContent = `${changes.ecology >= 0 ? '+' : ''}${changes.ecology}`;
          elements.ecologyChange.className = `score-change ${changes.ecology >= 0 ? 'text-green-500 bg-green-100' : 'text-red-500 bg-red-100'}`;
          setTimeout(() => elements.ecologyChange.classList.add('hidden'), 2000);
        }
        // 民生变化
        if (changes.people) {
          elements.peopleChange.textContent = `${changes.people >= 0 ? '+' : ''}${changes.people}`;
          elements.peopleChange.className = `score-change ${changes.people >= 0 ? 'text-green-500 bg-green-100' : 'text-red-500 bg-red-100'}`;
          setTimeout(() => elements.peopleChange.classList.add('hidden'), 2000);
        }
      }
    }

    // 显示决策场景
    function showDecisionScene() {
      const scenario = gameData.scenarios[gameData.stage - 1];
      elements.decisionTitle.textContent = scenario.title;
      elements.decisionDescription.textContent = scenario.description;
      elements.decisionCards.innerHTML = '';

      // 创建决策卡片（不显示分数影响）
      scenario.decisions.forEach((decision) => {
        const card = document.createElement('div');
        card.className = 'decision-card';
        card.innerHTML = `<p class="text-gray-700">${decision.text}</p>`;
        card.addEventListener('click', () => makeDecision(decision));
        elements.decisionCards.appendChild(card);
      });

      // 显示决策区域
      elements.transitionSection.classList.add('hidden');
      elements.decisionSection.classList.remove('hidden');
    }

    // 做出决策
    function makeDecision(decision) {
      // 记录变化值
      const changes = {
        economy: decision.effects.economy,
        ecology: decision.effects.ecology,
        people: decision.effects.people
      };

      // 更新数据（限制在0-100之间）
      gameData.stats.economy = Math.max(0, Math.min(100, gameData.stats.economy + changes.economy));
      gameData.stats.ecology = Math.max(0, Math.min(100, gameData.stats.ecology + changes.ecology));
      gameData.stats.people = Math.max(0, Math.min(100, gameData.stats.people + changes.people));
      
      // 更新显示并展示变化
      updateStats(true, changes);

      // 显示结果
      elements.resultDescription.textContent = decision.result;
      elements.theoryText.textContent = decision.theory;
      elements.decisionSection.classList.add('hidden');
      elements.resultSection.classList.remove('hidden');
    }

    // 进入下一阶段
    function nextStage() {
      gameData.stage++;
      elements.stageIndicator.textContent = `阶段：${gameData.stage}/${gameData.maxStages}`;

      if (gameData.stage > gameData.maxStages) {
        // 显示最终结果
        showFinalResult();
      } else {
        // 显示过渡剧情（最后一个阶段除外）
        const scenario = gameData.scenarios[gameData.stage - 2];
        elements.transitionTitle.textContent = scenario.transition.title;
        elements.transitionText.textContent = scenario.transition.text;
        
        elements.resultSection.classList.add('hidden');
        elements.transitionSection.classList.remove('hidden');
      }
    }

    // 显示最终结果
    function showFinalResult() {
      const totalScore = Math.round((gameData.stats.economy + gameData.stats.ecology + gameData.stats.people) / 3);
      elements.finalScore.textContent = `综合评分：${totalScore}分`;

      // 生成详细评价
      let evaluation = '';
      if (totalScore >= 80) {
        evaluation = "你的十年任期内，小镇实现了经济发展、生态保护和民生改善的有机统一。经济持续增长，环境优美宜居，居民幸福感强，成为科学发展的典范。这得益于你始终坚持全面协调可持续的发展理念，统筹兼顾各方利益，真正做到了以人为本。";
      } else if (totalScore >= 60) {
        evaluation = "小镇发展取得了一定成绩，但存在明显的不平衡问题：可能经济发展较好但生态受损，或民生改善显著但经济动力不足。这说明你在统筹兼顾方面还有提升空间，需要更深刻理解科学发展观的内涵，在发展中实现各领域的协调平衡。";
      } else if (totalScore >= 40) {
        evaluation = "小镇发展存在严重失衡，过度侧重某一领域而忽视了其他方面，导致发展不可持续。这反映出对科学发展观的理解不够深入，未能把握'全面协调可持续'的基本要求，需要在发展理念和方法上进行反思和改进。";
      } else {
        evaluation = "小镇发展陷入困境，经济、生态、民生均出现问题。这说明发展思路违背了科学发展观的基本原理，没有正确处理发展与保护、增长与民生的关系。科学发展观强调，发展必须是全面的、协调的、可持续的，必须坚持以人为本，才能实现真正的发展。";
      }
      elements.finalEvaluation.textContent = evaluation;

      elements.resultSection.classList.add('hidden');
      elements.finalResult.classList.remove('hidden');
    }

    // 重新开始游戏
    function restartGame() {
      gameData.stage = 1;
      gameData.stats = { economy: 30, ecology: 40, people: 35 };
      elements.stageIndicator.textContent = `阶段：1/8`;
      updateStats();
      elements.finalResult.classList.add('hidden');
      elements.storySection.classList.remove('hidden');
    }

    // 初始化事件监听
    function initEvents() {
      elements.startBtn.addEventListener('click', showDecisionScene);
      elements.nextBtn.addEventListener('click', nextStage);
      elements.continueBtn.addEventListener('click', showDecisionScene);
      elements.restartBtn.addEventListener('click', restartGame);
    }

    // 初始化游戏
    function initGame() {
      updateStats();
      initEvents();
    }

    // 启动游戏
    window.onload = initGame;
  </script>
</body>
</html>